{"version":3,"sources":["app.js"],"names":["$","App","Collections","Models","Views","Backbone","View","extend","el","bigPartyTemplate","html","bigPartyOpen","append","this","find","fadeIn","bigPartyClose","fadeOut","remove","pep","toggleAll","initialize","self","on","Drop","events","click .js-avatarClose","click .js-addBtn","click .js-removeBtn","mouseup .js-dropItem:not(.pep-start)","touchend .js-dropItem:not(.pep-start)","submit #friendsForm","touch","alert","sendFriends","e","preventDefault","$form","currentTarget","dataArray","serializeArray","url","attr","ajax","type","data","done","console","log","fail","always","addItem","$currentTarget","id","$selectedItem","dragView","$el","css","poacity","visibility","saveSelectedItem","closeAvatar","removeItem","$dragItem","removeSelectedItem","opacity","collection","models","length","appView","hide","click","$target","infoAvatarTemplate","infoTemplate","currentItem","findWhere","renderedAvatar","Mustache","render","toJSON","renderedInfo","show","removeClass","emailText","each","dropItem","index","dropItemView","DropItem","model","get","val","droppable","drag","addClass","stop","event","object","$item","intersected","activeDropRegions","revert","debug","place","template","tagName","className","rendered","icon","Drag","mouseup .js-dragItem:not(.pep-start)","touchend .js-dragItem:not(.pep-start)","mousedown","mouseup","itemId","dropItems","push","$empty","availableItem","dragItem","DragItem","dropView","Avatar","AvailableItems","Collection","parse","response","posts","fetch","reset","SelectedItems","dragItems"],"mappings":"AAAAA,EAAA,WACA,GAAAC,KACAA,GAAAC,eACAD,EAAAE,UACAF,EAAAG,SASAH,EAAAG,MAAAH,IAAAI,SAAAC,KAAAC,QACAC,GAAA,eACAC,iBAAAT,EAAA,qBAAAU,OACAC,aAAA,WACAX,EAAA,QAAAY,OAAAC,KAAAJ,kBACAT,EAAA,QAAAc,KAAA,0CAAAC,OAAA,SAEAC,cAAA,WACAhB,EAAA,QAAAc,KAAA,0CAAAG,QAAA,OAAA,WACAjB,EAAA,QAAAc,KAAA,0CAAAI,SACAlB,EAAAmB,IAAAC,WAAA,MAGAC,WAAA,WACA,GAAAC,GAAAT,IACAb,GAAA,QAAAuB,GAAA,iBAAA,4CAAA,WACAD,EAAAN,qBAMAf,EAAAG,MAAAoB,KAAAnB,SAAAC,KAAAC,QACAC,GAAA,WACAiB,QACAC,wBAAA,cACAC,mBAAA,UACAC,sBAAA,aACAC,uCAAA,QACAC,wCAAA,QACAC,sBAAA,eAEAC,MAAA,WACAC,MAAA,QAEAC,YAAA,SAAAC,GACAA,EAAAC,gBAEA,IAAAC,GAAArC,EAAAmC,EAAAG,eACAC,EAAAF,EAAAG,iBACAC,EAAAJ,EAAAK,KAAA,SAEA1C,GAAA2C,MACAF,IAAAA,EACAG,KAAA,OACAC,KAAAN,IAEAO,KAAA,WACAC,QAAAC,IAAA,aAEAC,KAAA,WACAF,QAAAC,IAAA,WAEAE,OAAA,WACAH,QAAAC,IAAA,eAIAG,QAAA,SAAAhB,GACA,GAAAiB,GAAApD,EAAAmC,EAAAG,eACAe,EAAAD,EAAAP,KAAA,MACAS,EAAAC,EAAAC,IAAA1C,KAAA,aAAAuC,EAGAC,GAAAG,KACAC,QAAA,EACAC,WAAA,WAGAJ,EAAAK,iBAAAN,GAEAzC,KAAAgD,eAEAC,WAAA,SAAA3B,GACA,GAAAiB,GAAApD,EAAAmC,EAAAG,eACAe,EAAAD,EAAAP,KAAA,MACAS,EAAAzC,KAAA2C,IAAA1C,KAAA,aAAAuC,GACAU,EAAAR,EAAAC,IAAA1C,KAAA,aAAAuC,EAGAC,GAAApC,SAEAL,KAAAgD,cAEAN,EAAAS,mBAAAD,GAEAA,EAAAN,KACAQ,QAAA,EACAN,WAAA,YAIA,IAAA9C,KAAAqD,WAAAC,OAAAC,QACAC,EAAAb,IAAA1C,KAAA,iBAAAwD,QAGAC,MAAA,SAAApC,GACA,GAAAqC,GAAAxE,EAAAmC,EAAAG,eACAmC,EAAAzE,EAAA,+BAAAU,OACAgE,EAAA1E,EAAA,iBAAAU,OACAiE,EAAA9D,KAAAqD,WAAAU,WACAvB,GAAAmB,EAAA3B,KAAA,QAEAgC,EAAAC,SAAAC,OAAAN,EAAAE,EAAAK,UACAC,EAAAH,SAAAC,OAAAL,EAAAC,EAAAK,SAEAhF,GAAA,gBAAAU,KAAAuE,GAEApE,KAAA2C,IAAA1C,KAAA,cAAAI,SAEAL,KAAA2C,IAAA5C,OAAAiE,GACAhE,KAAA2C,IAAA1C,KAAA,cAAAwD,OACAzD,KAAA2C,IAAA1C,KAAA,iBAAAoE,QAEArB,YAAA,WAEA7D,EAAA,gBAAAmF,YAAA,UAEAtE,KAAA2C,IAAA1C,KAAA,cAAAI,SAEAmD,EAAAb,IAAA1C,KAAA,gBAAAJ,KAAA,IACA2D,EAAAb,IAAA1C,KAAA,wBAAAJ,KAAA,WAEAW,WAAA,WACAR,KAAAqD,WAAA3C,GAAA,aAAA,WACAV,KAAAkE,UACAlE,OAEAkE,OAAA,WACA,GAAAzD,GAAAT,KACAuE,EAAA,EAGAf,GAAAb,IAAA1C,KAAA,iBAAAoE,OAEAb,EAAAb,IAAA1C,KAAA,gBAAAJ,KAAA,IAEAG,KAAA2C,IAAA1C,KAAA,qBAAAJ,KAAA,IAEAG,KAAAqD,WAAAmB,KAAA,SAAAC,EAAAC,GACA,GAAAC,GAAA,GAAAvF,GAAAG,MAAAqF,UACAC,MAAAJ,GAGAF,IADAG,EAAA,IAAAjE,EAAA4C,WAAAC,OAAAC,OACAkB,EAAAK,IAAA,SAEAL,EAAAK,IAAA,SAAA,KAGA9E,KAAA2C,IAAA1C,KAAA,qBAAAF,OAAA4E,EAAAhC,IAAAX,KAAA,cAAAyC,EAAAK,IAAA,UAGA3F,EAAA,gBAAAY,OAAA,OAAA0E,EAAAK,IAAA,SAAA,UACA9E,MAGAwD,EAAAb,IAAA1C,KAAA,iBAAA8E,IAAAR,GAGApF,EAAA,gBAAAmB,KACA0E,UAAA,gBACAC,KAAA,WACAzB,EAAAb,IAAA1C,KAAA,qBAAAiF,SAAA,aAEAC,KAAA,SAAAC,EAAAC,GACA,GAAAC,GAAAnG,EAAAkG,EAAA1F,IACA4F,EAAAvF,KAAAwF,kBAAAjC,OACAf,EAAA8C,EAAAtD,KAAA,KAEAuD,KAEA7C,EAAAS,mBAAAmC,GAEA5C,EAAAC,IAAA1C,KAAA,aAAAuC,GAAAI,KACAE,WAAA,UACAM,QAAA,IAGA,IAAA3C,EAAA4C,WAAAC,OAAAC,QACAC,EAAAb,IAAA1C,KAAA,iBAAAwD,QAKAD,EAAAb,IAAA1C,KAAA,qBAAAqE,YAAA,aAEAmB,QAAA,EACAC,OAAA,EACAC,OAAA,OAKAvG,EAAAG,MAAAqF,SAAApF,SAAAC,KAAAC,QACAkG,SAAAzG,EAAA,qBAAAU,OACAgG,QAAA,KACAC,UAAA,6BACAtF,WAAA,WACAR,KAAAkE,UAEAA,OAAA,WACA,GAAA6B,GAAA9B,SAAAC,OAAAlE,KAAA4F,SAAA5F,KAAA6E,MAAAV,SAMA,OALAnE,MAAA2C,IAAA9C,KAAAkG,GACA/F,KAAA2C,IAAAuC,SAAA,kBAAAlF,KAAA6E,MAAAC,IAAA,iBAAAkB,MACAhG,KAAA2C,IAAAuC,SAAA,UACAlF,KAAA2C,IAAAd,KAAA,KAAA,YAAA7B,KAAA6E,MAAAC,IAAA,OACA9E,KAAA2C,IAAAX,KAAA,KAAAhC,KAAA6E,MAAAC,IAAA,OACA9E,QAKAZ,EAAAG,MAAA0G,KAAAzG,SAAAC,KAAAC,QACAC,GAAA,WACAiB,QACAsF,uCAAA,QACAC,wCAAA,SAEA3F,WAAA,WACAR,KAAAqD,WAAA3C,GAAA,QAAA,WACAV,KAAAkE,UACAlE,OAEAoG,UAAA,SAAA9E,GACAnC,EAAAmC,EAAAG,gBAEA4E,QAAA,SAAA/E,GACAnC,EAAAmC,EAAAG,gBAEAiC,MAAA,SAAApC,GACA,GAAAqC,GAAAxE,EAAAmC,EAAAG,eACAmC,EAAAzE,EAAA,+BAAAU,OACAgE,EAAA1E,EAAA,iBAAAU,OACAiE,EAAA9D,KAAAqD,WAAAU,WACAvB,GAAAmB,EAAA3B,KAAA,QAEAgC,EAAAC,SAAAC,OAAAN,EAAAE,EAAAK,UACAC,EAAAH,SAAAC,OAAAL,EAAAC,EAAAK,SAEAhF,GAAA,gBAAAU,KAAAuE,GAGAZ,EAAAb,IAAA1C,KAAA,wBAAAJ,KAAAiE,EAAAgB,IAAA,UAEA3F,EAAA,YAAAc,KAAA,cAAAI,SACAlB,EAAA,gBAAAmF,YAAA,UACAX,EAAAuB,SAAA,UACA/F,EAAA,YAAAY,OAAAiE,GACA7E,EAAA,YAAAc,KAAA,iBAAAwD,OACAtE,EAAA,YAAAc,KAAA,cAAAoE,QAGAtB,iBAAA,SAAAuC,GACA,GAAAgB,GAAAhB,EAAAtD,KAAA,MACA8B,EAAA9D,KAAAqD,WAAAU,WACAvB,GAAA8D,GAGAhB,GAAA1C,KACAQ,QAAA,EACAN,WAAA,WAEAyD,EAAAC,KAAA1C,IAEAX,mBAAA,SAAAmC,GACA,GAAAgB,GAAAhB,EAAAtD,KAAA,MACA8B,EAAA9D,KAAAqD,WAAAU,WACAvB,GAAA8D,GAGAC,GAAAlG,OAAAyD,IAEAI,OAAA,WACA,GAAAzD,GAAAT,KACAyG,EAAAtH,EAAA,gBAEAa,MAAA2C,IAAA9C,KAAA,IACA4G,EAAA5G,KAAA,IACAG,KAAAqD,WAAAmB,KAAA,SAAAkC,GACA,GAAAC,GAAA,GAAAvH,GAAAG,MAAAqH,UACA/B,MAAA6B,GAEA1G,MAAA2C,IAAA5C,OAAA4G,EAAAhE,IAAAX,KAAA,cAAA0E,EAAA5B,IAAA,UACA2B,EAAA1G,OAAA,2CACAC,MAGAb,EAAA,gBAAAmB,KACA0E,UAAA,WACAC,KAAA,aAGAE,KAAA,SAAAC,EAAAC,GACA,GAAAC,GAAAnG,EAAAkG,EAAA1F,IACA4F,EAAAvF,KAAAwF,kBAAAjC,MAGA,OAAA,KAAAsD,EAAAxD,WAAAC,OAAAC,QACApE,EAAAmB,IAAAC,WAAA,GACAiD,EAAA1D,gBACA,QAGAyF,IACA9E,EAAAsC,iBAAAuC,GAGAuB,EAAA7D,iBAIAyC,QAAA,EACAC,OAAA,EACAC,OAAA,OAKAvG,EAAAG,MAAAqH,SAAApH,SAAAC,KAAAC,QACAkG,SAAAzG,EAAA,qBAAAU,OACAgG,QAAA,KACAC,UAAA,6BACAtF,WAAA,WACAR,KAAAkE,UAEAA,OAAA,WACA,GAAA6B,GAAA9B,SAAAC,OAAAlE,KAAA4F,SAAA5F,KAAA6E,MAAAV,SAKA,OAJAnE,MAAA2C,IAAA9C,KAAAkG,GACA/F,KAAA2C,IAAAuC,SAAA,kBAAAlF,KAAA6E,MAAAC,IAAA,iBAAAkB,MACAhG,KAAA2C,IAAAd,KAAA,KAAA,YAAA7B,KAAA6E,MAAAC,IAAA,OACA9E,KAAA2C,IAAAX,KAAA,KAAAhC,KAAA6E,MAAAC,IAAA,OACA9E,QAIAZ,EAAAG,MAAAuH,OAAAtH,SAAAC,KAAAC,QACAC,GAAA,aACAiB,QACAE,mBAAA,OAYA1B,EAAAC,YAAA0H,eAAAvH,SAAAwH,WAAAtH,QACAkC,IAAAzC,EAAA,qBAAA6C,KAAA,OACAiF,MAAA,SAAAC,GACA,MAAAA,GAAAC,OAEA3G,WAAA,WACAR,KAAAoH,OACAC,OAAA,OAKAjI,EAAAC,YAAAiI,cAAA9H,SAAAwH,WAAAtH,UAQA,IAAA6H,GAAA,GAAAnI,GAAAC,YAAA0H,eACAR,EAAA,GAAAnH,GAAAC,YAAAiI,cAEA9D,EAAA,GAAApE,GAAAG,MAAAH,IACAsD,EAAA,GAAAtD,GAAAG,MAAA0G,MACA5C,WAAAkE,IAEAV,EAAA,GAAAzH,GAAAG,MAAAoB,MACA0C,WAAAkD","file":"app.js","sourcesContent":["$(function () {\n\tvar App = {};\n\tApp.Collections = {};\n\tApp.Models = {};\n\tApp.Views = {};\n\n\t/*****************\n\t *\n\t *  Views\n\t *\n\t ******************/\n\n\t// Main view\n\tApp.Views.App = Backbone.View.extend({\n\t\tel: '.js-services',\n\t\tbigPartyTemplate: $('#bigPartyTemplate').html(),\n\t\tbigPartyOpen: function () {\n\t\t\t$('body').append(this.bigPartyTemplate);\n\t\t\t$('body').find('.js-bigPartyModal, .js-bigPartyOverlay').fadeIn('fast');\n\t\t},\n\t\tbigPartyClose: function () {\n\t\t\t$('body').find('.js-bigPartyModal, .js-bigPartyOverlay').fadeOut('fast', function () {\n\t\t\t\t$('body').find('.js-bigPartyModal, .js-bigPartyOverlay').remove();\n\t\t\t\t$.pep.toggleAll(true);\n\t\t\t});\n\t\t},\n\t\tinitialize: function () {\n\t\t\tvar self = this;\n\t\t\t$('body').on('click touchend', '.js-bigPartyCloseBtn, .js-bigPartyOverlay', function () {\n\t\t\t\tself.bigPartyClose();\n\t\t\t});\n\t\t}\n\t});\n\n\t// Drop view\n\tApp.Views.Drop = Backbone.View.extend({\n\t\tel: '.js-drop',\n\t\tevents: {\n\t\t\t'click .js-avatarClose': 'closeAvatar',\n\t\t\t'click .js-addBtn': 'addItem',\n\t\t\t'click .js-removeBtn': 'removeItem',\n\t\t\t'mouseup .js-dropItem:not(.pep-start)': 'click',\n\t\t\t'touchend .js-dropItem:not(.pep-start)': 'click',\n\t\t\t'submit #friendsForm': 'sendFriends'\n\t\t},\n\t\ttouch: function () {\n\t\t\talert('tap');\n\t\t},\n\t\tsendFriends: function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar $form = $(e.currentTarget),\n\t\t\t\tdataArray = $form.serializeArray(),\n\t\t\t\turl = $form.attr('action');\n\n\t\t\t$.ajax({\n\t\t\t\turl: url,\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: dataArray,\n\t\t\t})\n\t\t\t\t.done(function () {\n\t\t\t\t\tconsole.log(\"success\");\n\t\t\t\t})\n\t\t\t\t.fail(function () {\n\t\t\t\t\tconsole.log(\"error\");\n\t\t\t\t})\n\t\t\t\t.always(function () {\n\t\t\t\t\tconsole.log(\"complete\");\n\t\t\t\t});\n\n\t\t},\n\t\taddItem: function (e) {\n\t\t\tvar $currentTarget = $(e.currentTarget),\n\t\t\t\tid = $currentTarget.data('id'),\n\t\t\t\t$selectedItem = dragView.$el.find('#dragItem-' + id);\n\n\t\t\t// Hide selected drop item\n\t\t\t$selectedItem.css({\n\t\t\t\tpoacity: 0,\n\t\t\t\tvisibility: 'hidden'\n\t\t\t});\n\t\t\t// Save drag selected item\n\t\t\tdragView.saveSelectedItem($selectedItem);\n\t\t\t// Close big avatar\n\t\t\tthis.closeAvatar();\n\t\t},\n\t\tremoveItem: function (e) {\n\t\t\tvar $currentTarget = $(e.currentTarget),\n\t\t\t\tid = $currentTarget.data('id'),\n\t\t\t\t$selectedItem = this.$el.find('#dropItem-' + id),\n\t\t\t\t$dragItem = dragView.$el.find('#dragItem-' + id);\n\n\t\t\t// Remove selected item\n\t\t\t$selectedItem.remove();\n\t\t\t// Close big avatar\n\t\t\tthis.closeAvatar();\n\t\t\t// Remove model from collection\n\t\t\tdragView.removeSelectedItem($dragItem);\n\t\t\t// Show drag item\n\t\t\t$dragItem.css({\n\t\t\t\topacity: 1,\n\t\t\t\tvisibility: 'visible'\n\t\t\t});\n\n\t\t\t// Hide short info if no models\n\t\t\tif (this.collection.models.length === 0) {\n\t\t\t\tappView.$el.find('.js-shortInfo').hide();\n\t\t\t}\n\t\t},\n\t\tclick: function (e) {\n\t\t\tvar $target = $(e.currentTarget),\n\t\t\t\tinfoAvatarTemplate = $('#selectedItemAvatarTemplate').html(),\n\t\t\t\tinfoTemplate = $('#infoTemplate').html(),\n\t\t\t\tcurrentItem = this.collection.findWhere({\n\t\t\t\t\tid: $target.data('id')\n\t\t\t\t}),\n\t\t\t\trenderedAvatar = Mustache.render(infoAvatarTemplate, currentItem.toJSON()),\n\t\t\t\trenderedInfo = Mustache.render(infoTemplate, currentItem.toJSON());\n\n\t\t\t$('.js-itemInfo').html(renderedInfo);\n\n\t\t\tthis.$el.find('.js-avatar').remove();\n\n\t\t\tthis.$el.append(renderedAvatar);\n\t\t\tthis.$el.find('.js-addBtn').hide();\n\t\t\tthis.$el.find('.js-removeBtn').show();\n\t\t},\n\t\tcloseAvatar: function () {\n\t\t\t// Change buttons add/remove\n\t\t\t$('.js-dragItem').removeClass('active');\n\t\t\t// Clear big avatar\n\t\t\tthis.$el.find('.js-avatar').remove();\n\t\t\t// Clear info\n\t\t\tappView.$el.find('.js-itemInfo').html('');\n\t\t\tappView.$el.find('.js-selectedItemName').html('&nbsp;');\n\t\t},\n\t\tinitialize: function () {\n\t\t\tthis.collection.on('add remove', function () {\n\t\t\t\tthis.render();\n\t\t\t}, this);\n\t\t},\n\t\trender: function () {\n\t\t\tvar self = this,\n\t\t\t\temailText = '';\n\n\t\t\t// Show short info\n\t\t\tappView.$el.find('.js-shortInfo').show();\n\t\t\t// Clear short info\n\t\t\tappView.$el.find('.js-selected').html('');\n\t\t\t// Clear drop area\n\t\t\tthis.$el.find('.js-selectedItems').html('');\n\n\t\t\tthis.collection.each(function (dropItem, index) {\n\t\t\t\tvar dropItemView = new App.Views.DropItem({\n\t\t\t\t\tmodel: dropItem\n\t\t\t\t});\n\t\t\t\tif (index + 1 === self.collection.models.length) {\n\t\t\t\t\temailText += dropItem.get('title');\n\t\t\t\t} else {\n\t\t\t\t\temailText += dropItem.get('title') + ', ';\n\t\t\t\t}\n\n\t\t\t\tthis.$el.find('.js-selectedItems').append(dropItemView.$el.data('serviceName', dropItem.get('name')));\n\n\t\t\t\t// Render short info\n\t\t\t\t$('.js-selected').append('<li>' + dropItem.get('title') + '</li>');\n\t\t\t}, this);\n\n\n\t\t\tappView.$el.find('#servicesList').val(emailText);\n\n\t\t\t// Drag init\n\t\t\t$('.js-dropItem').pep({\n\t\t\t\tdroppable: '.js-dragEmpty',\n\t\t\t\tdrag: function (event, object) {\n\t\t\t\t\tappView.$el.find('.js-selectedItems').addClass('dragging');\n\t\t\t\t},\n\t\t\t\tstop: function (event, object) {\n\t\t\t\t\tvar $item = $(object.el),\n\t\t\t\t\t\tintersected = this.activeDropRegions.length,\n\t\t\t\t\t\tid = $item.data('id');\n\n\t\t\t\t\tif (intersected) {\n\t\t\t\t\t\t// Remove item\n\t\t\t\t\t\tdragView.removeSelectedItem($item);\n\t\t\t\t\t\t// Show item in drag area\n\t\t\t\t\t\tdragView.$el.find('#dragItem-' + id).css({\n\t\t\t\t\t\t\tvisibility: 'visible',\n\t\t\t\t\t\t\topacity: 1\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Hide short info if no models\n\t\t\t\t\t\tif (self.collection.models.length === 0) {\n\t\t\t\t\t\t\tappView.$el.find('.js-shortInfo').hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove dragging class\n\t\t\t\t\tappView.$el.find('.js-selectedItems').removeClass('dragging');\n\t\t\t\t},\n\t\t\t\trevert: true,\n\t\t\t\tdebug: false,\n\t\t\t\tplace: false\n\t\t\t});\n\t\t}\n\t});\n\t// Drop item view\n\tApp.Views.DropItem = Backbone.View.extend({\n\t\ttemplate: $('#dragItemTemplate').html(),\n\t\ttagName: 'li',\n\t\tclassName: 'services__item js-dropItem',\n\t\tinitialize: function () {\n\t\t\tthis.render();\n\t\t},\n\t\trender: function () {\n\t\t\tvar rendered = Mustache.render(this.template, this.model.toJSON());\n\t\t\tthis.$el.html(rendered);\n\t\t\tthis.$el.addClass('services__item_' + this.model.get('custom_fields').icon);\n\t\t\tthis.$el.addClass('active');\n\t\t\tthis.$el.attr('id', 'dropItem-' + this.model.get('id'));\n\t\t\tthis.$el.data('id', this.model.get('id'));\n\t\t\treturn this;\n\t\t}\n\t});\n\n\t// Available drag view\n\tApp.Views.Drag = Backbone.View.extend({\n\t\tel: '.js-drag',\n\t\tevents: {\n\t\t\t'mouseup .js-dragItem:not(.pep-start)': 'click',\n\t\t\t'touchend .js-dragItem:not(.pep-start)': 'click'\n\t\t},\n\t\tinitialize: function () {\n\t\t\tthis.collection.on('reset', function () {\n\t\t\t\tthis.render();\n\t\t\t}, this);\n\t\t},\n\t\tmousedown: function (e) {\n\t\t\tvar $target = $(e.currentTarget);\n\t\t},\n\t\tmouseup: function (e) {\n\t\t\tvar $target = $(e.currentTarget);\n\t\t},\n\t\tclick: function (e) {\n\t\t\tvar $target = $(e.currentTarget),\n\t\t\t\tinfoAvatarTemplate = $('#selectedItemAvatarTemplate').html(),\n\t\t\t\tinfoTemplate = $('#infoTemplate').html(),\n\t\t\t\tcurrentItem = this.collection.findWhere({\n\t\t\t\t\tid: $target.data('id')\n\t\t\t\t}),\n\t\t\t\trenderedAvatar = Mustache.render(infoAvatarTemplate, currentItem.toJSON()),\n\t\t\t\trenderedInfo = Mustache.render(infoTemplate, currentItem.toJSON());\n\n\t\t\t$('.js-itemInfo').html(renderedInfo);\n\n\t\t\t// Change title\n\t\t\tappView.$el.find('.js-selectedItemName').html(currentItem.get('title'));\n\n\t\t\t$('.js-drop').find('.js-avatar').remove();\n\t\t\t$('.js-dragItem').removeClass('active');\n\t\t\t$target.addClass('active');\n\t\t\t$('.js-drop').append(renderedAvatar);\n\t\t\t$('.js-drop').find('.js-removeBtn').hide();\n\t\t\t$('.js-drop').find('.js-addBtn').show();\n\n\t\t},\n\t\tsaveSelectedItem: function ($item) {\n\t\t\tvar itemId = $item.data('id'),\n\t\t\t\tcurrentItem = this.collection.findWhere({\n\t\t\t\t\tid: itemId\n\t\t\t\t});\n\n\t\t\t$item.css({\n\t\t\t\topacity: 0,\n\t\t\t\tvisibility: 'hidden'\n\t\t\t});\n\t\t\tdropItems.push(currentItem);\n\t\t},\n\t\tremoveSelectedItem: function ($item) {\n\t\t\tvar itemId = $item.data('id'),\n\t\t\t\tcurrentItem = this.collection.findWhere({\n\t\t\t\t\tid: itemId\n\t\t\t\t});\n\n\t\t\tdropItems.remove(currentItem);\n\t\t},\n\t\trender: function () {\n\t\t\tvar self = this,\n\t\t\t\t$empty = $('.js-dragEmpty');\n\n\t\t\tthis.$el.html('');\n\t\t\t$empty.html('');\n\t\t\tthis.collection.each(function (availableItem, index) {\n\t\t\t\tvar dragItem = new App.Views.DragItem({\n\t\t\t\t\tmodel: availableItem\n\t\t\t\t});\n\t\t\t\tthis.$el.append(dragItem.$el.data('serviceName', availableItem.get('name')));\n\t\t\t\t$empty.append('<li class=\"services__empty-item\"></li>');\n\t\t\t}, this);\n\n\t\t\t// Drag init\n\t\t\t$('.js-dragItem').pep({\n\t\t\t\tdroppable: '.js-drop',\n\t\t\t\tdrag: function () {\n\n\t\t\t\t},\n\t\t\t\tstop: function (event, object) {\n\t\t\t\t\tvar $item = $(object.el),\n\t\t\t\t\t\tintersected = this.activeDropRegions.length;\n\n\t\t\t\t\t// Check max models count\n\t\t\t\t\tif (dropView.collection.models.length === 9) {\n\t\t\t\t\t\t$.pep.toggleAll(false);\n\t\t\t\t\t\tappView.bigPartyOpen();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (intersected) {\n\t\t\t\t\t\tself.saveSelectedItem($item);\n\n\t\t\t\t\t\t// Close avatar\n\t\t\t\t\t\tdropView.closeAvatar();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\trevert: true,\n\t\t\t\tdebug: false,\n\t\t\t\tplace: false\n\t\t\t});\n\t\t}\n\t});\n\t// Available drag item view\n\tApp.Views.DragItem = Backbone.View.extend({\n\t\ttemplate: $('#dragItemTemplate').html(),\n\t\ttagName: 'li',\n\t\tclassName: 'services__item js-dragItem',\n\t\tinitialize: function () {\n\t\t\tthis.render();\n\t\t},\n\t\trender: function () {\n\t\t\tvar rendered = Mustache.render(this.template, this.model.toJSON());\n\t\t\tthis.$el.html(rendered);\n\t\t\tthis.$el.addClass('services__item_' + this.model.get('custom_fields').icon);\n\t\t\tthis.$el.attr('id', 'dragItem-' + this.model.get('id'));\n\t\t\tthis.$el.data('id', this.model.get('id'));\n\t\t\treturn this;\n\t\t}\n\t});\n\t// Avatar view\n\tApp.Views.Avatar = Backbone.View.extend({\n\t\tel: '.js-avatar',\n\t\tevents: {\n\t\t\t'click .js-addBtn': 'ч'\n\t\t}\n\t});\n\n\n\t/*****************\n\t *\n\t *  Collections\n\t *\n\t ******************/\n\n\t// Available items\n\tApp.Collections.AvailableItems = Backbone.Collection.extend({\n\t\turl: $('#dragItemTemplate').data('url'),\n\t\tparse: function (response) {\n\t\t\treturn response.posts;\n\t\t},\n\t\tinitialize: function () {\n\t\t\tthis.fetch({\n\t\t\t\treset: true\n\t\t\t});\n\t\t}\n\t});\n\t// Selected items\n\tApp.Collections.SelectedItems = Backbone.Collection.extend({});\n\n\n\t/*****************\n\t *\n\t *  Initialize\n\t *\n\t ******************/\n\tvar dragItems = new App.Collections.AvailableItems(),\n\t\tdropItems = new App.Collections.SelectedItems();\n\n\tvar appView = new App.Views.App(),\n\t\tdragView = new App.Views.Drag({\n\t\t\tcollection: dragItems\n\t\t}),\n\t\tdropView = new App.Views.Drop({\n\t\t\tcollection: dropItems\n\t\t});\n});\n"],"sourceRoot":"/source/"}