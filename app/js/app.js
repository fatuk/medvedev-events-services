$(function(){var e={};e.Collections={},e.Models={},e.Views={},e.Views.App=Backbone.View.extend({el:".js-services",bigPartyTemplate:$("#bigPartyTemplate").html(),bigPartyOpen:function(){$("body").append(this.bigPartyTemplate),$("body").find(".js-bigPartyModal, .js-bigPartyOverlay").fadeIn("fast")},bigPartyClose:function(){$("body").find(".js-bigPartyModal, .js-bigPartyOverlay").fadeOut("fast",function(){$("body").find(".js-bigPartyModal, .js-bigPartyOverlay").remove(),$.pep.toggleAll(!0)})},initialize:function(){var e=this;$("body").on("click",".js-bigPartyCloseBtn, .js-bigPartyOverlay",function(){e.bigPartyClose()})}}),e.Views.Drop=Backbone.View.extend({el:".js-drop",events:{"click .js-avatarClose":"closeAvatar","click .js-addBtn":"addItem","click .js-removeBtn":"removeItem","mouseup .js-dropItem:not(.pep-start)":"click","submit #friendsForm":"sendFriends"},sendFriends:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.serializeArray(),s=t.attr("action");$.ajax({url:s,type:"POST",data:i}).done(function(){console.log("success")}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},addItem:function(e){var t=$(e.currentTarget),i=t.data("id"),s=a.$el.find("#dragItem-"+i);s.css({poacity:0,visibility:"hidden"}),a.saveSelectedItem(s),this.closeAvatar()},removeItem:function(e){var t=$(e.currentTarget),i=t.data("id"),l=this.$el.find("#dropItem-"+i),n=a.$el.find("#dragItem-"+i);l.remove(),this.closeAvatar(),a.removeSelectedItem(n),n.css({opacity:1,visibility:"visible"}),0===this.collection.models.length&&s.$el.find(".js-shortInfo").hide()},click:function(e){var t=$(e.currentTarget),i=$("#selectedItemAvatarTemplate").html(),s=$("#infoTemplate").html(),a=this.collection.findWhere({id:t.data("id")}),l=Mustache.render(i,a.toJSON()),n=Mustache.render(s,a.toJSON());$(".js-itemInfo").html(n),this.$el.find(".js-avatar").remove(),this.$el.append(l),this.$el.find(".js-addBtn").hide(),this.$el.find(".js-removeBtn").show()},closeAvatar:function(){$(".js-dragItem").removeClass("active"),this.$el.find(".js-avatar").remove(),s.$el.find(".js-itemInfo").html(""),s.$el.find(".js-selectedItemName").html("&nbsp;")},initialize:function(){this.collection.on("add remove",function(){this.render()},this)},render:function(){var t=this,i="";s.$el.find(".js-shortInfo").show(),s.$el.find(".js-selected").html(""),this.$el.find(".js-selectedItems").html(""),this.collection.each(function(s,a){var l=new e.Views.DropItem({model:s});i+=a+1===t.collection.models.length?s.get("title"):s.get("title")+", ",this.$el.find(".js-selectedItems").append(l.$el.data("serviceName",s.get("name"))),$(".js-selected").append("<li>"+s.get("title")+"</li>")},this),s.$el.find("#servicesList").val(i),$(".js-dropItem").pep({droppable:".js-drag",drag:function(){s.$el.find(".js-selectedItems").addClass("dragging")},stop:function(e,i){var l=$(i.el),n=this.activeDropRegions.length,o=l.data("id");n&&(a.removeSelectedItem(l),a.$el.find("#dragItem-"+o).css({visibility:"visible",opacity:1}),0===t.collection.models.length&&s.$el.find(".js-shortInfo").hide()),s.$el.find(".js-selectedItems").removeClass("dragging")},revert:!0,debug:!1,place:!1})}}),e.Views.DropItem=Backbone.View.extend({template:$("#dragItemTemplate").html(),tagName:"li",className:"services__item js-dropItem",initialize:function(){this.render()},render:function(){var e=Mustache.render(this.template,this.model.toJSON());return this.$el.html(e),this.$el.addClass("services__item_"+this.model.get("custom_fields").icon),this.$el.addClass("active"),this.$el.attr("id","dropItem-"+this.model.get("id")),this.$el.data("id",this.model.get("id")),this}}),e.Views.Drag=Backbone.View.extend({el:".js-drag",events:{"mouseup .js-dragItem:not(.pep-start)":"click"},initialize:function(){this.collection.on("reset",function(){this.render()},this)},mousedown:function(e){$(e.currentTarget)},mouseup:function(e){$(e.currentTarget)},click:function(e){var t=$(e.currentTarget),i=$("#selectedItemAvatarTemplate").html(),a=$("#infoTemplate").html(),l=this.collection.findWhere({id:t.data("id")}),n=Mustache.render(i,l.toJSON()),o=Mustache.render(a,l.toJSON());$(".js-itemInfo").html(o),s.$el.find(".js-selectedItemName").html(l.get("title")),$(".js-drop").find(".js-avatar").remove(),$(".js-dragItem").removeClass("active"),t.addClass("active"),$(".js-drop").append(n),$(".js-drop").find(".js-removeBtn").hide(),$(".js-drop").find(".js-addBtn").show()},saveSelectedItem:function(e){var t=e.data("id"),s=this.collection.findWhere({id:t});e.css({opacity:0,visibility:"hidden"}),i.push(s)},removeSelectedItem:function(e){var t=e.data("id"),s=this.collection.findWhere({id:t});i.remove(s)},render:function(){var t=this,i=$(".js-dragEmpty");this.$el.html(""),i.html(""),this.collection.each(function(t){var s=new e.Views.DragItem({model:t});this.$el.append(s.$el.data("serviceName",t.get("name"))),i.append('<li class="services__empty-item"></li>')},this),$(".js-dragItem").pep({droppable:".js-drop",drag:function(){},stop:function(e,i){var a=$(i.el),n=this.activeDropRegions.length;return 9===l.collection.models.length?($.pep.toggleAll(!1),s.bigPartyOpen(),!1):void(n&&(t.saveSelectedItem(a),l.closeAvatar()))},revert:!0,debug:!1,place:!1})}}),e.Views.DragItem=Backbone.View.extend({template:$("#dragItemTemplate").html(),tagName:"li",className:"services__item js-dragItem",initialize:function(){this.render()},render:function(){var e=Mustache.render(this.template,this.model.toJSON());return this.$el.html(e),this.$el.addClass("services__item_"+this.model.get("custom_fields").icon),this.$el.attr("id","dragItem-"+this.model.get("id")),this.$el.data("id",this.model.get("id")),this}}),e.Views.Avatar=Backbone.View.extend({el:".js-avatar",events:{"click .js-addBtn":"Ñ‡"}}),e.Collections.AvailableItems=Backbone.Collection.extend({url:$("#dragItemTemplate").data("url"),parse:function(e){return e.posts},initialize:function(){this.fetch({reset:!0})}}),e.Collections.SelectedItems=Backbone.Collection.extend({});var t=new e.Collections.AvailableItems,i=new e.Collections.SelectedItems,s=new e.Views.App,a=new e.Views.Drag({collection:t}),l=new e.Views.Drop({collection:i})});
//# sourceMappingURL=../js/app.js.map